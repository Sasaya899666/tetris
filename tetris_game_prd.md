# 進階Web版俄羅斯方塊遊戲 - 產品需求文檔 (PRD)

## 1. 產品概述

### 1.1 產品名稱
**Web Tetris Pro** - 進階網頁版俄羅斯方塊遊戲

### 1.2 產品願景
打造一款具有現代化界面、完整排行榜系統的網頁版俄羅斯方塊遊戲，提供流暢的遊戲體驗和競技樂趣。

### 1.3 目標用戶
- 休閒遊戲玩家
- 俄羅斯方塊愛好者
- 喜歡競技排行榜的玩家

## 2. 功能需求

### 2.1 核心遊戲功能

#### 2.1.1 基本遊戲機制
- **方塊形狀**: 7種標準俄羅斯方塊形狀 (I, O, T, S, Z, J, L)
- **方塊操作**:
  - 左右移動 (A/D 或 ←/→)
  - 順時針旋轉 (W 或 ↑)
  - 逆時針旋轉 (Q)
  - 快速下降 (S 或 ↓)
  - 瞬間落下 (空白鍵)
  - 暫停/繼續 (P)

#### 2.1.2 遊戲規則
- **遊戲區域**: 10x20 網格
- **消除機制**: 完整填滿一行即消除
- **計分系統**:
  - 單行消除: 100分 × 等級
  - 雙行消除: 300分 × 等級
  - 三行消除: 500分 × 等級
  - 四行消除(Tetris): 800分 × 等級
  - 軟降分數: 每格1分
  - 硬降分數: 每格2分

#### 2.1.3 遊戲進階機制
- **等級系統**: 每消除10行提升一級
- **速度遞增**: 等級越高，方塊下降速度越快
- **下一個方塊預覽**: 顯示接下來的方塊
- **保留功能**: 玩家可保留一個方塊待用 (Hold)
- **幽靈方塊**: 顯示方塊落下位置的預覽

### 2.2 排行榜系統

#### 2.2.1 分數記錄機制
- 遊戲結束時自動檢查分數是否進入前十名
- 如果進入前十名，彈出姓名輸入對話框
- 姓名限制: 2-20個字符，支援中英文
- 記錄時間戳記

#### 2.2.2 排行榜顯示
- 顯示前十名玩家
- 顯示內容: 排名、姓名、分數、達成時間
- 支援排行榜重置功能（管理員權限）

### 2.3 用戶界面功能

#### 2.3.1 遊戲界面
- **主遊戲區**: 方塊遊戲區域
- **信息面板**:
  - 當前分數
  - 當前等級
  - 已消除行數
  - 下一個方塊預覽
  - 保留方塊顯示
- **控制面板**: 遊戲控制按鈕

#### 2.3.2 菜單系統
- **主菜單**:
  - 開始遊戲
  - 排行榜
  - 遊戲說明
  - 設定
- **暫停菜單**:
  - 繼續遊戲
  - 重新開始
  - 返回主菜單

#### 2.3.3 設定選項
- 音效開關
- 背景音樂開關
- 按鍵設定
- 遊戲速度調整

## 3. 技術架構

### 3.1 前端技術
- **HTML5**: 遊戲界面結構
- **CSS3**: 響應式設計、動畫效果
- **JavaScript**: 
  - 遊戲邏輯實現
  - DOM操作
  - AJAX與後端通信
  - Canvas繪圖（可選）

### 3.2 後端技術
- **Python Framework**: Flask 或 FastAPI
- **API設計**: RESTful API
- **功能模組**:
  - 遊戲分數處理
  - 排行榜管理
  - 數據驗證

### 3.3 數據庫設計
- **SQLite**: 輕量級數據庫
- **主要表格**:
  - `leaderboard`: 排行榜記錄
  - `game_sessions`: 遊戲會話記錄（可選）

### 3.4 系統架構
```
前端 (HTML/CSS/JS) ↔ 後端 API (Python) ↔ SQLite 數據庫
```

## 4. 數據庫設計

### 4.1 leaderboard 表
```sql
CREATE TABLE leaderboard (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    player_name VARCHAR(50) NOT NULL,
    score INTEGER NOT NULL,
    level_reached INTEGER,
    lines_cleared INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4.2 遊戲會話表（可選擴展）
```sql
CREATE TABLE game_sessions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id VARCHAR(100),
    score INTEGER,
    duration INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 5. API設計

### 5.1 排行榜相關API
- `GET /api/leaderboard` - 獲取前10名排行榜
- `POST /api/leaderboard` - 提交新的高分記錄
- `GET /api/leaderboard/check/{score}` - 檢查分數是否能進入前10名

### 5.2 請求/響應格式
```json
// POST /api/leaderboard
{
    "player_name": "玩家姓名",
    "score": 15000,
    "level": 5,
    "lines_cleared": 45
}

// GET /api/leaderboard 響應
{
    "success": true,
    "data": [
        {
            "rank": 1,
            "player_name": "玩家A",
            "score": 25000,
            "level": 8,
            "created_at": "2024-01-15T10:30:00"
        }
    ]
}
```

## 6. 用戶體驗流程

### 6.1 遊戲開始流程
1. 用戶訪問網頁
2. 顯示主菜單界面
3. 點擊"開始遊戲"
4. 遊戲界面載入，開始遊戲

### 6.2 遊戲結束流程
1. 方塊無法繼續放置，遊戲結束
2. 顯示"Game Over"畫面和最終分數
3. 後端檢查分數是否進入前10名
4. 如果是：
   - 彈出姓名輸入對話框
   - 用戶輸入姓名並提交
   - 更新排行榜
5. 顯示排行榜
6. 提供"再玩一次"或"返回主菜單"選項

### 6.3 排行榜查看流程
1. 主菜單點擊"排行榜"
2. 顯示前10名排行榜
3. 提供"返回主菜單"選項

## 7. 非功能需求

### 7.1 性能需求
- 遊戲畫面更新頻率: 60 FPS
- API響應時間: < 200ms
- 頁面載入時間: < 3秒

### 7.2 兼容性需求
- 支援主流瀏覽器: Chrome, Firefox, Safari, Edge
- 響應式設計，支援桌面和平板設備
- 最低螢幕解析度: 1024x768

### 7.3 安全性需求
- 輸入驗證和清理
- SQL注入防護
- XSS攻擊防護
- 分數驗證機制

### 7.4 可用性需求
- 直觀的用戶界面
- 明確的操作提示
- 平滑的動畫效果
- 鍵盤和滑鼠雙重支援

## 8. 開發階段規劃

### 階段一: 基礎遊戲開發
- 基本俄羅斯方塊遊戲邏輯
- 簡單的用戶界面
- 本地分數系統

### 階段二: 後端整合
- Python後端API開發
- SQLite數據庫設置
- 前後端整合

### 階段三: 排行榜系統
- 分數檢查機制
- 姓名輸入界面
- 排行榜顯示功能

### 階段四: 優化與測試
- 性能優化
- 用戶體驗優化
- 全面測試

## 9. 風險評估

### 9.1 技術風險
- 前端遊戲性能優化挑戰
- 瀏覽器兼容性問題
- 數據安全性考量

### 9.2 緩解策略
- 採用成熟的遊戲開發模式
- 充分的跨瀏覽器測試
- 實施安全最佳實踐

## 10. 成功指標

### 10.1 功能指標
- 遊戲運行穩定性 > 99%
- 排行榜更新準確性 100%
- 用戶操作響應時間 < 100ms

### 10.2 用戶體驗指標
- 遊戲載入時間 < 3秒
- 操作流暢度評分 > 4.5/5
- 用戶留存率（可後續追蹤）

---

**文檔版本**: 1.0  
**最後更新**: 2024年1月  
**負責人**: 開發團隊